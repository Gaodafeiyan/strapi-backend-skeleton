# 商城系统集成总结

## 系统架构概述

商城系统与现有的投资、抽奖、邀请奖励系统完全集成，共享用户认证、钱包余额等核心功能。

## 新增API模块

### 1. 商城商品 (shop-product)
- **功能**: 商品管理，支持商品、金币、优惠券三种类型
- **主要字段**: 
  - 商品名称、描述、图片
  - 价格、原价、库存、已售数量
  - 商品状态、标签、规格
  - 热门、新品、推荐标识
- **API接口**:
  - `GET /shop-products` - 商品列表（支持分页、筛选、搜索）
  - `GET /shop-products/:id` - 商品详情
  - `GET /shop-products/hot/list` - 热门商品
  - `GET /shop-products/new/list` - 新品
  - `GET /shop-products/recommend/list` - 推荐商品
  - `GET /shop-products/search` - 搜索商品
  - `GET /shop-products/categories` - 商品分类

### 2. 商城订单 (shop-order)
- **功能**: 订单管理，支持单商品购买和购物车批量结算
- **主要字段**:
  - 订单号、状态、数量、单价、总金额
  - 收货地址、电话、姓名、物流单号
  - 支付时间、发货时间、送达时间
- **API接口**:
  - `POST /shop-orders` - 创建订单
  - `POST /shop-orders/:id/pay` - 支付订单
  - `POST /shop-orders/:id/ship` - 发货
  - `POST /shop-orders/:id/confirm-delivery` - 确认收货
  - `POST /shop-orders/:id/cancel` - 取消订单
  - `GET /shop-orders/my/orders` - 我的订单
  - `POST /shop-orders/checkout-from-cart` - 购物车结算

### 3. 购物车 (shop-cart)
- **功能**: 购物车管理，支持商品添加、数量更新、选中状态切换
- **主要字段**:
  - 商品数量、选中状态
  - 关联用户和商品
- **API接口**:
  - `POST /shop-carts/add-to-cart` - 添加到购物车
  - `PUT /shop-carts/:id/quantity` - 更新数量
  - `DELETE /shop-carts/:id/remove` - 删除商品
  - `POST /shop-carts/:id/toggle-selected` - 切换选中状态
  - `POST /shop-carts/toggle-all-selected` - 全选/取消全选
  - `GET /shop-carts/my/cart` - 我的购物车
  - `DELETE /shop-carts/my/clear` - 清空购物车
  - `GET /shop-carts/my/stats` - 购物车统计

## 系统集成点

### 1. 用户系统集成
- 扩展用户模型，添加购物车和订单关联
- 共享用户认证和权限系统
- 支持邀请码注册

### 2. 钱包系统集成
- 订单支付直接从用户钱包扣除USDT余额
- 实时余额检查和更新
- 支持钱包充值、提现功能

### 3. 投资系统关联
- 用户可以通过投资获得USDT收益
- 收益可用于商城购物
- 投资等级可能影响商城优惠

### 4. 邀请奖励系统关联
- 商城消费可能产生邀请奖励
- 邀请奖励直接进入钱包余额
- 支持邀请奖励查询和统计

## 业务流程

### 1. 商品浏览和购买流程
```
用户浏览商品 → 添加到购物车 → 选择商品 → 填写收货信息 → 支付订单 → 商家发货 → 确认收货
```

### 2. 购物车结算流程
```
选择购物车商品 → 填写收货信息 → 系统检查库存和余额 → 创建订单 → 扣除钱包余额 → 更新库存 → 删除购物车商品
```

### 3. 订单管理流程
```
待付款 → 已付款 → 已发货 → 已送达 → 已完成
```

## 技术特点

### 1. 数据一致性
- 使用事务确保订单创建、钱包扣款、库存更新的原子性
- 实时库存检查，防止超卖
- 钱包余额实时验证

### 2. 安全性
- 所有敏感操作需要用户认证
- 订单操作权限验证
- 钱包余额不足时的友好提示

### 3. 扩展性
- 支持多种商品类型（商品、金币、优惠券）
- 灵活的筛选和搜索功能
- 支持批量操作和统计

### 4. 用户体验
- 购物车实时统计
- 订单状态实时更新
- 友好的错误提示

## 前端集成建议

### 1. 商城页面
- 商品列表展示（支持分类、搜索、排序）
- 商品详情页面
- 购物车页面
- 订单管理页面

### 2. 用户中心集成
- 在用户中心添加"我的订单"入口
- 显示购物车商品数量
- 集成钱包余额显示

### 3. 导航菜单
- 添加"商城"菜单项
- 购物车图标显示商品数量
- 订单状态通知

## 测试建议

### 1. 功能测试
- 商品浏览和搜索
- 购物车操作
- 订单创建和支付
- 库存管理
- 钱包余额更新

### 2. 集成测试
- 与现有投资系统的集成
- 与邀请奖励系统的集成
- 用户认证和权限验证

### 3. 性能测试
- 大量商品数据的加载性能
- 并发订单处理能力
- 数据库查询优化

## 部署注意事项

### 1. 数据库迁移
- 需要创建新的数据表
- 更新用户表结构
- 设置适当的索引

### 2. 权限配置
- 配置商城相关API的访问权限
- 设置用户角色和权限

### 3. 文件上传
- 配置商品图片上传功能
- 设置适当的文件大小限制

### 4. 监控和日志
- 添加订单相关的日志记录
- 监控关键业务指标
- 设置异常告警

## 后续扩展方向

### 1. 支付系统
- 支持多种支付方式
- 集成第三方支付网关
- 支持分期付款

### 2. 物流系统
- 集成物流API
- 实时物流跟踪
- 自动发货功能

### 3. 营销功能
- 优惠券系统
- 限时折扣
- 会员等级优惠

### 4. 评价系统
- 商品评价
- 商家评价
- 评分统计

### 5. 推荐系统
- 基于用户行为的商品推荐
- 个性化推荐算法
- 热门商品推荐 