# APIæµ‹è¯•ç»“æœåˆ†ææŠ¥å‘Š

## æµ‹è¯•æ¦‚è¿°
- **æµ‹è¯•æ—¶é—´**: 2025-07-25 14:42:52 - 14:43:30
- **æµ‹è¯•APIæ•°é‡**: 21ä¸ªä¸»è¦APIæ¨¡å—
- **æœåŠ¡å™¨**: http://118.107.4.158:1337

## æµ‹è¯•ç»“æœç»Ÿè®¡

### æˆåŠŸçŠ¶æ€ (200/201/204)
âœ… **æ­£å¸¸å·¥ä½œçš„API**:
- æ ¹è·¯å¾„ `/` (200)
- ç®¡ç†åå° `/admin` (200)
- ç”¨æˆ·åˆ—è¡¨ `/api/users` (200)
- è§’è‰²åˆ—è¡¨ `/api/users-permissions/roles` (200)
- å¥åº·æ£€æŸ¥ `/api/health` (200)
- é’±åŒ…åˆ—è¡¨ `/api/qianbao-yues` (200)
- é’±åŒ…åœ°å€åˆ—è¡¨ `/api/wallet-addresses` (200)
- å……å€¼è®°å½• `/api/qianbao-chongzhis` (200)
- æç°è®°å½• `/api/qianbao-tixians` (200)
- è®¤è´­è®¡åˆ’ `/api/dinggou-jihuas` (200)
- è®¤è´­è®¢å• `/api/dinggou-dingdans` (200)
- é‚€è¯·å¥–åŠ± `/api/yaoqing-jianglis` (200)
- æŠ½å¥–æœºä¼š `/api/choujiang-jihuis` (200)
- å¥–å“åˆ—è¡¨ `/api/choujiang-jiangpins` (200)
- AIä»£å¸ `/api/ai-tokens` (200)
- ä»£å¸å¥–åŠ±è®°å½• `/api/token-reward-records` (200)
- å•†å“åˆ—è¡¨ `/api/shop-products` (200)
- è´­ç‰©è½¦ `/api/shop-carts` (200)
- è®¢å•åˆ—è¡¨ `/api/shop-orders` (200)
- é€šçŸ¥åˆ—è¡¨ `/api/notices` (200)
- ç¼“å­˜åˆ—è¡¨ `/api/caches` (200)
- ç”¨æˆ·æ•°é‡ `/api/users/count` (200)
- åˆ é™¤ç¼“å­˜ `/api/caches/test_key` (204)

### éœ€è¦è®¤è¯ (401/403)
ğŸ”’ **éœ€è¦è®¤è¯çš„API**:
- è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ `/api/users/me` (401)
- æç°åˆ›å»º `/api/qianbao-tixians` (401)
- è®¤è´­è®¢å•åˆ›å»º `/api/dinggou-dingdans` (403)
- æŠ½å¥–è®°å½• `/api/choujiang-ji-lus` (403)
- å†…éƒ¨æ¶ˆæ¯ `/api/internal-messages` (403)
- ç®¡ç†ä»ªè¡¨æ¿ `/api/admin-dashboards` (403)
- ç®¡ç†ç»Ÿè®¡ `/api/admin-dashboards/stats` (403)
- æ€§èƒ½ç›‘æ§ `/api/performance-monitors` (403)
- é˜Ÿåˆ—ç®¡ç† `/api/queues` (403)
- é˜Ÿåˆ—çŠ¶æ€ `/api/queues/status` (403)

### æœªæ‰¾åˆ° (404)
âŒ **è·¯ç”±ä¸å­˜åœ¨çš„API**:
- APIæ ¹è·¯å¾„ `/api` (404)
- ç”¨æˆ·é’±åŒ… `/api/qianbao-yues/user-wallet` (404)
- ä»£å¸ä½™é¢ `/api/qianbao-yues/token-balances` (404)
- ä»£å¸èµ é€è®°å½• `/api/qianbao-yues/token-reward-records` (404)
- æ´»è·ƒè®¤è´­è®¡åˆ’ `/api/dinggou-jihuas/active` (404)
- æˆ‘çš„é‚€è¯·è®°å½• `/api/yaoqing-jianglis/my-invites` (404)
- é‚€è¯·ç»Ÿè®¡ `/api/yaoqing-jianglis/invite-stats` (404)
- ä»£å¸å¸‚åœºæ•°æ® `/api/ai-tokens/market` (404)
- æˆ‘çš„å¥–åŠ±è®°å½• `/api/token-reward-records/my-rewards` (404)
- æ´»è·ƒé€šçŸ¥ `/api/notices/active` (404)
- Webhookåˆ—è¡¨ `/api/webhooks` (404)

### æ–¹æ³•ä¸å…è®¸ (405)
ğŸš« **HTTPæ–¹æ³•ä¸æ”¯æŒçš„API**:
- æŠ½å¥–æ‰§è¡Œ `/api/choujiang-jihuis/draw` (405)
- AIä»£å¸åˆ›å»º `/api/ai-tokens` (405)
- Webhookåˆ›å»º `/api/webhooks` (405)

### å®¢æˆ·ç«¯é”™è¯¯ (400)
âš ï¸ **è¯·æ±‚å‚æ•°é”™è¯¯çš„API**:
- é‚€è¯·ç æ³¨å†Œ `/api/auth/invite-register` (400) - ç”¨æˆ·åé•¿åº¦éªŒè¯å¤±è´¥
- ç”¨æˆ·ç™»å½• `/api/auth/local` (400) - ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯
- é’±åŒ…åœ°å€åˆ›å»º `/api/wallet-addresses` (400) - ç¼ºå°‘dataå­—æ®µ
- è®¤è´­è®¡åˆ’åˆ›å»º `/api/dinggou-jihuas` (400) - å‚æ•°éªŒè¯å¤±è´¥
- è´­ç‰©è½¦æ·»åŠ  `/api/shop-carts` (400) - å‚æ•°éªŒè¯å¤±è´¥
- è®¢å•åˆ›å»º `/api/shop-orders` (400) - å‚æ•°éªŒè¯å¤±è´¥
- ç¼“å­˜è®¾ç½® `/api/caches` (400) - å‚æ•°éªŒè¯å¤±è´¥

### æœåŠ¡å™¨é”™è¯¯ (500)
ğŸ’¥ **æœåŠ¡å™¨å†…éƒ¨é”™è¯¯çš„API**:
- å……å€¼è®¢å•åˆ›å»º `/api/qianbao-chongzhis` (500)
- AIä»£å¸æ´»è·ƒçŠ¶æ€ `/api/ai-tokens/active` (500)
- é€šçŸ¥åˆ›å»º `/api/notices` (500)
- ç”¨æˆ·ä¿¡æ¯æ›´æ–° `/api/users/null` (500) - userIdä¸ºnull

## ä¸»è¦é—®é¢˜åˆ†æ

### 1. è®¤è¯ç³»ç»Ÿé—®é¢˜
- é‚€è¯·ç æ³¨å†ŒåŠŸèƒ½å­˜åœ¨ç”¨æˆ·åé•¿åº¦éªŒè¯é—®é¢˜
- ç™»å½•åŠŸèƒ½éœ€è¦æ­£ç¡®çš„ç”¨æˆ·åå’Œå¯†ç æ ¼å¼
- å¤šä¸ªAPIéœ€è¦æ­£ç¡®çš„JWT tokenè®¤è¯

### 2. è·¯ç”±ç¼ºå¤±é—®é¢˜
- å¤šä¸ªè‡ªå®šä¹‰è·¯ç”±æœªæ­£ç¡®é…ç½®
- éƒ¨åˆ†APIç«¯ç‚¹è¿”å›404ï¼Œè¯´æ˜è·¯ç”±æœªæ³¨å†Œ

### 3. æ§åˆ¶å™¨æ–¹æ³•é—®é¢˜
- éƒ¨åˆ†APIä¸æ”¯æŒPOSTæ–¹æ³•ï¼Œéœ€è¦æ£€æŸ¥æ§åˆ¶å™¨å®ç°
- è‡ªå®šä¹‰æ–¹æ³•æœªæ­£ç¡®é…ç½®è·¯ç”±

### 4. æ•°æ®éªŒè¯é—®é¢˜
- å¤šä¸ªAPIçš„è¯·æ±‚å‚æ•°éªŒè¯å¤±è´¥
- ç¼ºå°‘å¿…è¦çš„dataå­—æ®µæˆ–å­—æ®µæ ¼å¼ä¸æ­£ç¡®

### 5. æœåŠ¡å™¨é”™è¯¯
- éƒ¨åˆ†APIå‡ºç°500é”™è¯¯ï¼Œéœ€è¦æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—
- æ•°æ®åº“è¿æ¥æˆ–æŸ¥è¯¢å¯èƒ½å­˜åœ¨é—®é¢˜

## ä¿®å¤å»ºè®®

### 1. ç«‹å³ä¿®å¤ (é«˜ä¼˜å…ˆçº§)
```javascript
// 1. ä¿®å¤é‚€è¯·ç æ³¨å†Œçš„ç”¨æˆ·åéªŒè¯
// åœ¨ auth.ts æ§åˆ¶å™¨ä¸­è°ƒæ•´ç”¨æˆ·åé•¿åº¦é™åˆ¶
if (!validateUsername(cleanUsername)) {
  return ctx.badRequest('ç”¨æˆ·åè‡³å°‘3ä¸ªå­—ç¬¦ï¼Œæœ€å¤š20ä¸ªå­—ç¬¦');
}

// 2. ä¿®å¤é’±åŒ…åœ°å€åˆ›å»ºçš„dataå­—æ®µé—®é¢˜
// ç¡®ä¿è¯·æ±‚ä½“åŒ…å«æ­£ç¡®çš„dataç»“æ„
{
  "data": {
    "address": "0x1234567890123456789012345678901234567890",
    "type": "ETH",
    "label": "æµ‹è¯•åœ°å€"
  }
}

// 3. ä¿®å¤ç”¨æˆ·IDä¸ºnullçš„é—®é¢˜
// åœ¨æµ‹è¯•è„šæœ¬ä¸­ç¡®ä¿userIdæ­£ç¡®è®¾ç½®
```

### 2. è·¯ç”±é…ç½®ä¿®å¤ (ä¸­ä¼˜å…ˆçº§)
```javascript
// 1. æ·»åŠ ç¼ºå¤±çš„è‡ªå®šä¹‰è·¯ç”±
// åœ¨ç›¸åº”çš„routesæ–‡ä»¶ä¸­æ·»åŠ 
{
  method: 'GET',
  path: '/api/qianbao-yues/user-wallet',
  handler: 'qianbao-yue.getUserWallet',
  config: { auth: { scope: ['authenticated'] } }
}

// 2. ä¿®å¤HTTPæ–¹æ³•ä¸æ”¯æŒçš„é—®é¢˜
// æ£€æŸ¥æ§åˆ¶å™¨æ˜¯å¦æ­£ç¡®å®ç°äº†POSTæ–¹æ³•
```

### 3. è®¤è¯ç³»ç»Ÿå®Œå–„ (ä¸­ä¼˜å…ˆçº§)
```javascript
// 1. å®Œå–„JWT tokenå¤„ç†
// ç¡®ä¿ç™»å½•æˆåŠŸåæ­£ç¡®è¿”å›token
// ç¡®ä¿åç»­è¯·æ±‚æ­£ç¡®æºå¸¦Authorizationå¤´

// 2. æ·»åŠ æƒé™éªŒè¯ä¸­é—´ä»¶
// ä¸ºéœ€è¦è®¤è¯çš„APIæ·»åŠ é€‚å½“çš„æƒé™æ£€æŸ¥
```

### 4. æ•°æ®éªŒè¯ä¼˜åŒ– (ä½ä¼˜å…ˆçº§)
```javascript
// 1. ç»Ÿä¸€è¯·æ±‚å‚æ•°éªŒè¯
// åˆ›å»ºé€šç”¨çš„éªŒè¯ä¸­é—´ä»¶
// ç¡®ä¿æ‰€æœ‰APIéƒ½æœ‰æ­£ç¡®çš„å‚æ•°éªŒè¯

// 2. é”™è¯¯å¤„ç†ä¼˜åŒ–
// æä¾›æ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
// ç»Ÿä¸€é”™è¯¯å“åº”æ ¼å¼
```

## æµ‹è¯•è„šæœ¬æ”¹è¿›å»ºè®®

### 1. ä¿®å¤æµ‹è¯•æ•°æ®
```javascript
// ä½¿ç”¨æ›´åˆé€‚çš„æµ‹è¯•ç”¨æˆ·å
const testUser = {
  username: `testuser_${Date.now()}`.substring(0, 20), // ç¡®ä¿é•¿åº¦é™åˆ¶
  email: `test_${Date.now()}@example.com`,
  password: 'Test123456!',
  inviteCode: INVITE_CODE
};
```

### 2. æ”¹è¿›è¯·æ±‚æ ¼å¼
```javascript
// ç¡®ä¿æ‰€æœ‰POSTè¯·æ±‚éƒ½åŒ…å«æ­£ç¡®çš„dataç»“æ„
const requestData = {
  data: {
    // å®é™…æ•°æ®
  }
};
```

### 3. æ·»åŠ è®¤è¯æµç¨‹
```javascript
// åœ¨æµ‹è¯•å¼€å§‹å‰å…ˆå®Œæˆç™»å½•
// ç¡®ä¿åç»­æµ‹è¯•ä½¿ç”¨æ­£ç¡®çš„token
```

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç«‹å³ä¿®å¤**: è§£å†³ç”¨æˆ·åéªŒè¯å’Œdataå­—æ®µé—®é¢˜
2. **è·¯ç”±æ£€æŸ¥**: ç¡®è®¤æ‰€æœ‰è‡ªå®šä¹‰è·¯ç”±æ˜¯å¦æ­£ç¡®é…ç½®
3. **è®¤è¯æµ‹è¯•**: ä½¿ç”¨æ­£ç¡®çš„ç”¨æˆ·å‡­æ®é‡æ–°æµ‹è¯•è®¤è¯æµç¨‹
4. **é”™è¯¯å¤„ç†**: æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—ï¼Œè§£å†³500é”™è¯¯
5. **é‡æ–°æµ‹è¯•**: ä¿®å¤é—®é¢˜åé‡æ–°è¿è¡Œå®Œæ•´æµ‹è¯•

## æ€»ç»“

å½“å‰åç«¯APIçš„åŸºç¡€åŠŸèƒ½åŸºæœ¬æ­£å¸¸ï¼Œä¸»è¦é—®é¢˜é›†ä¸­åœ¨ï¼š
- è®¤è¯ç³»ç»Ÿçš„å‚æ•°éªŒè¯
- è‡ªå®šä¹‰è·¯ç”±çš„é…ç½®
- è¯·æ±‚æ•°æ®æ ¼å¼çš„ç»Ÿä¸€
- é”™è¯¯å¤„ç†çš„å®Œå–„

å»ºè®®ä¼˜å…ˆä¿®å¤è®¤è¯å’Œè·¯ç”±é—®é¢˜ï¼Œç„¶åé€æ­¥å®Œå–„å…¶ä»–åŠŸèƒ½ã€‚ 