# è®¤è´­æ¿å—å¿«é€Ÿå¯¹æ¥æŒ‡å—

## ğŸš€ æ ¸å¿ƒAPIæ¥å£

### 1. è·å–è®¤è´­è®¡åˆ’åˆ—è¡¨
```bash
GET /api/dinggou-jihuas?filters[kaiqi]=true
```

### 2. åˆ›å»ºè®¤è´­è®¢å•
```bash
POST /api/dinggou-dingdans
Authorization: Bearer YOUR_JWT_TOKEN
Content-Type: application/json

{
  "data": {
    "jihuaId": 1
  }
}
```

### 3. è·å–ç”¨æˆ·è®¢å•åˆ—è¡¨
```bash
GET /api/dinggou-dingdans?populate[jihua]=true&sort=createdAt:desc
Authorization: Bearer YOUR_JWT_TOKEN
```

### 4. èµå›è®¢å•
```bash
POST /api/dinggou-dingdans/:id/redeem
Authorization: Bearer YOUR_JWT_TOKEN
Content-Type: application/json

{
  "force": false,
  "testMode": false
}
```

### 5. è·å–é’±åŒ…ä½™é¢
```bash
GET /api/qianbao-yues?filters[yonghu]=USER_ID
Authorization: Bearer YOUR_JWT_TOKEN
```

## ğŸ“Š å…³é”®æ•°æ®å­—æ®µ

### è®¤è´­è®¡åˆ’å­—æ®µ
- `jihuaCode`: è®¡åˆ’ä»£ç  (å¦‚ "PLAN500")
- `benjinUSDT`: æœ¬é‡‘é‡‘é¢ (å¦‚ "500")
- `zhouQiTian`: å‘¨æœŸå¤©æ•° (å¦‚ 15)
- `jingtaiBili`: é™æ€æ”¶ç›Šæ¯”ä¾‹ (å¦‚ "6")
- `aiBili`: AIä»£å¸æ¯”ä¾‹ (å¦‚ "3")
- `choujiangCi`: æŠ½å¥–æ¬¡æ•° (å¦‚ 3)
- `kaiqi`: æ˜¯å¦å¼€å¯

### è®¢å•çŠ¶æ€
- `active`: è¿›è¡Œä¸­
- `redeemable`: å¯èµå›
- `finished`: å·²å®Œæˆ

## ğŸ”§ Flutteré›†æˆè¦ç‚¹

### 1. æœåŠ¡ç±»
```dart
class SubscriptionService {
  final HttpClient _httpClient = HttpClient();

  // è·å–è®¤è´­è®¡åˆ’
  Future<Map<String, dynamic>> getPlans() async {
    final response = await _httpClient.dio.get('/api/dinggou-jihuas?filters[kaiqi]=true');
    return {'success': true, 'data': response.data};
  }

  // åˆ›å»ºè®¢å•
  Future<Map<String, dynamic>> createOrder(int planId) async {
    final response = await _httpClient.dio.post('/api/dinggou-dingdans', data: {
      'data': {'jihuaId': planId}
    });
    return {'success': true, 'data': response.data};
  }

  // è·å–è®¢å•åˆ—è¡¨
  Future<Map<String, dynamic>> getOrders() async {
    final response = await _httpClient.dio.get('/api/dinggou-dingdans?populate[jihua]=true&sort=createdAt:desc');
    return {'success': true, 'data': response.data};
  }

  // èµå›è®¢å•
  Future<Map<String, dynamic>> redeemOrder(int orderId) async {
    final response = await _httpClient.dio.post('/api/dinggou-dingdans/$orderId/redeem', data: {
      'force': false,
      'testMode': false
    });
    return {'success': true, 'data': response.data};
  }
}
```

### 2. é¡µé¢ç»“æ„
```dart
// è®¤è´­è®¡åˆ’é¡µé¢
class SubscriptionPlansPage extends StatefulWidget {
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: Text('è®¤è´­è®¡åˆ’')),
      body: ListView.builder(
        itemBuilder: (context, index) {
          final plan = plans[index]['attributes'];
          return Card(
            child: ListTile(
              title: Text(plan['jihuaCode']),
              subtitle: Text('æœ¬é‡‘: ${plan['benjinUSDT']} USDT'),
              trailing: ElevatedButton(
                onPressed: () => _createOrder(plans[index]['id']),
                child: Text('è®¤è´­'),
              ),
            ),
          );
        },
      ),
    );
  }
}

// è®¢å•åˆ—è¡¨é¡µé¢
class OrderListPage extends StatefulWidget {
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: Text('æˆ‘çš„è®¢å•')),
      body: ListView.builder(
        itemBuilder: (context, index) {
          final order = orders[index]['attributes'];
          final plan = order['jihua']['data']['attributes'];
          return Card(
            child: ListTile(
              title: Text(plan['jihuaCode']),
              subtitle: Text('çŠ¶æ€: ${order['zhuangtai']}'),
              trailing: order['zhuangtai'] == 'redeemable' 
                ? ElevatedButton(
                    onPressed: () => _redeemOrder(orders[index]['id']),
                    child: Text('èµå›'),
                  )
                : null,
            ),
          );
        },
      ),
    );
  }
}
```

## âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹

### 1. è®¤è¯è¦æ±‚
- åˆ›å»ºè®¢å•ã€è·å–è®¢å•ã€èµå›è®¢å•éƒ½éœ€è¦JWT Token
- ç¡®ä¿HTTPå®¢æˆ·ç«¯å·²é…ç½®è®¤è¯æ‹¦æˆªå™¨

### 2. ä¸šåŠ¡è§„åˆ™
- ç”¨æˆ·å¿…é¡»æœ‰è¶³å¤ŸUSDTä½™é¢æ‰èƒ½åˆ›å»ºè®¢å•
- è®¢å•åˆ°æœŸå‰ä¸èƒ½èµå›ï¼ˆé™¤éå¼ºåˆ¶èµå›ï¼‰
- èµå›æˆåŠŸåä¼šè·å¾—é™æ€æ”¶ç›Šã€AIä»£å¸å’ŒæŠ½å¥–æœºä¼š

### 3. é”™è¯¯å¤„ç†
```dart
try {
  final result = await service.createOrder(planId);
  if (result['success']) {
    // æˆåŠŸå¤„ç†
  } else {
    // é”™è¯¯å¤„ç†
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(content: Text(result['message'])),
    );
  }
} on DioException catch (e) {
  // ç½‘ç»œé”™è¯¯å¤„ç†
  String message = e.response?.data?['error']?['message'] ?? 'ç½‘ç»œé”™è¯¯';
  ScaffoldMessenger.of(context).showSnackBar(
    SnackBar(content: Text(message)),
  );
}
```

## ğŸ§ª æµ‹è¯•æ•°æ®

### æµ‹è¯•è®¡åˆ’
```json
{
  "jihuaCode": "PLAN500",
  "benjinUSDT": "500",
  "zhouQiTian": 15,
  "jingtaiBili": "6",
  "aiBili": "3",
  "choujiangCi": 3,
  "kaiqi": true
}
```

### æµ‹è¯•è®¢å•
```json
{
  "benjinUSDT": "500",
  "zhuangtai": "active",
  "kaishiShiJian": "2024-01-01T00:00:00.000Z",
  "jieshuShiJian": "2024-01-16T00:00:00.000Z"
}
```

## ğŸ“ å¿«é€Ÿæµ‹è¯•

### 1. è·å–è®¡åˆ’åˆ—è¡¨
```bash
curl -X GET "http://118.107.4.158:1337/api/dinggou-jihuas?filters[kaiqi]=true"
```

### 2. åˆ›å»ºè®¢å•ï¼ˆéœ€è¦ç™»å½•ï¼‰
```bash
curl -X POST "http://118.107.4.158:1337/api/dinggou-dingdans" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"data":{"jihuaId":1}}'
```

### 3. è·å–è®¢å•åˆ—è¡¨
```bash
curl -X GET "http://118.107.4.158:1337/api/dinggou-dingdans?populate[jihua]=true" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [å®Œæ•´å¯¹æ¥æ–‡æ¡£](./è®¤è´­æ¿å—å¯¹æ¥æ–‡æ¡£.md)
- [APIæ–‡æ¡£](http://118.107.4.158:1337/api/documentation)
- [ç™»å½•æ³¨å†Œå¯¹æ¥æ–‡æ¡£](./å‰ç«¯ç™»å½•æ³¨å†Œå¯¹æ¥æ–‡æ¡£.md)

---

*å¿«é€ŸæŒ‡å—æ›´æ–°æ—¶é—´: 2024å¹´1æœˆ1æ—¥* 